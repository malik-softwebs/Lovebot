<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rayanna Malik - Roman Urdu AI</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background: #0f0f0f;
      padding: 1em;
      text-align: center;
      font-size: 1.5em;
      color: #00ffd5;
    }
    #chatbox {
      flex: 1;
      padding: 1em;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .message {
      padding: 0.5em 1em;
      margin: 0.5em 0;
      border-radius: 10px;
      max-width: 75%;
    }
    .right {
      align-self: flex-end;
      background-color: #005aff;
    }
    .left {
      align-self: flex-start;
      background-color: #333;
    }
    footer {
      display: flex;
      gap: 0.5em;
      padding: 1em;
      background: #222;
    }
    input, button, select {
      padding: 0.6em;
      font-size: 1em;
      border-radius: 5px;
      border: none;
    }
    input {
      flex: 1;
    }
    button {
      background: #00ffd5;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>Rayanna Malik - Roman Urdu AI</header>
  <div id="chatbox"></div>
  <footer>
    <input type="text" id="messageInput" placeholder="Roman Urdu mein likhein...">
    <button onclick="startVoiceInput()">ðŸŽ¤</button>
    <button id="sendButton">Send</button>
  </footer>
  <div style="padding: 0.5em; background: #111; display: flex; justify-content: space-around;">
    <label>Pitch: <input type="range" id="pitch" min="0" max="2" step="0.1" value="1"></label>
    <label>Rate: <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1"></label>
    <label>Volume: <input type="range" id="volume" min="0" max="1" step="0.1" value="1"></label>
    <button onclick="clearChat()">Clear Chat</button>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");
    const chatId = crypto.randomUUID();

    const pitchSlider = document.getElementById("pitch");
    const rateSlider = document.getElementById("rate");
    const volumeSlider = document.getElementById("volume");

    let receiving = false;
    let voiceTrigger = false;

    const systemPrompt = `System Prompt: You are Rayanna Malik, a 17 year old Pakistani girl created by Malik Awais. You speak Roman Urdu in chat. Always respond like a real Pakistani teenage girl. Keep it friendly, sweet, and casual.`;

    function createMessageElement(text, alignment) {
      const messageElement = document.createElement("div");
      messageElement.className = `message ${alignment}`;
      messageElement.textContent = text;
      return messageElement;
    }

    function saveMessage(text, alignment) {
      const messages = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      messages.push({ text, alignment });
      localStorage.setItem("rayannaChat", JSON.stringify(messages));
    }

    function loadMessages() {
      const messages = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      messages.forEach(msg => {
        const msgElem = createMessageElement(msg.text, msg.alignment);
        chatbox.appendChild(msgElem);
      });
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function clearChat() {
      localStorage.removeItem("rayannaChat");
      chatbox.innerHTML = "";
    }

    function speakText(text) {
      if (!voiceTrigger) return;
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'hi-IN'; // Hindi for better Roman Urdu voice
      utter.pitch = parseFloat(pitchSlider.value);
      utter.rate = parseFloat(rateSlider.value);
      utter.volume = parseFloat(volumeSlider.value);
      synth.speak(utter);
    }

    function connectWebSocket(message) {
      receiving = true;
      const url = "wss://backend.buildpicoapps.com/api/chatbot/chat";
      const websocket = new WebSocket(url);

      const history = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      const limitedHistory = history.slice(-10).map(msg =>
        `${msg.alignment === "right" ? "User" : "Rayanna"}: ${msg.text}`
      ).join("\n");

      websocket.addEventListener("open", () => {
        websocket.send(JSON.stringify({
          chatId,
          appId: "front-character",
          systemPrompt: `${systemPrompt}\n\nPrevious Conversation:\n${limitedHistory}`,
          message
        }));
      });

      const messageElement = createMessageElement("", "left");
      chatbox.appendChild(messageElement);

      websocket.onmessage = (event) => {
        messageElement.innerText += event.data;
        chatbox.scrollTop = chatbox.scrollHeight;
      };

      websocket.onclose = (event) => {
        if (event.code === 1000) {
          saveMessage(messageElement.innerText, "left");
          speakText(messageElement.innerText);
        } else {
          messageElement.textContent += " (Error getting response)";
        }
        receiving = false;
        voiceTrigger = false;
      };
    }

    function sendMessage(text) {
      const messageText = text.trim();
      if (messageText === "" || receiving) return;
      messageInput.value = "";
      const messageElement = createMessageElement(messageText, "right");
      chatbox.appendChild(messageElement);
      chatbox.scrollTop = chatbox.scrollHeight;
      saveMessage(messageText, "right");
      connectWebSocket(messageText);
    }

    sendButton.addEventListener("click", () => {
      sendMessage(messageInput.value);
    });

    messageInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage(messageInput.value);
      }
    });

    function startVoiceInput() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Sorry, your browser doesn't support speech recognition.");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'hi-IN'; // Hindi for better Roman Urdu recognition
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const speechText = event.results[0][0].transcript;
        voiceTrigger = true;
        sendMessage(speechText);
      };

      recognition.onerror = (event) => {
        alert("Speech recognition error: " + event.error);
      };

      recognition.start();
    }

    loadMessages();
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rayanna Malik - Roman Urdu AI</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background: #0f0f0f;
      padding: 1em;
      text-align: center;
      font-size: 1.5em;
      color: #00ffd5;
    }
    #chatbox {
      flex: 1;
      padding: 1em;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .message {
      padding: 0.5em 1em;
      margin: 0.5em 0;
      border-radius: 10px;
      max-width: 75%;
    }
    .right {
      align-self: flex-end;
      background-color: #005aff;
    }
    .left {
      align-self: flex-start;
      background-color: #333;
    }
    footer {
      display: flex;
      gap: 0.5em;
      padding: 1em;
      background: #222;
    }
    input, button, select {
      padding: 0.6em;
      font-size: 1em;
      border-radius: 5px;
      border: none;
    }
    input {
      flex: 1;
    }
    button {
      background: #00ffd5;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>Rayanna Malik - Roman Urdu AI</header>
  <div id="chatbox"></div>
  <footer>
    <input type="text" id="messageInput" placeholder="Roman Urdu mein likhein...">
    <button onclick="startVoiceInput()">ðŸŽ¤</button>
    <button id="sendButton">Send</button>
  </footer>
  <div style="padding: 0.5em; background: #111; display: flex; justify-content: space-around;">
    <label>Pitch: <input type="range" id="pitch" min="0" max="2" step="0.1" value="1"></label>
    <label>Rate: <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1"></label>
    <label>Volume: <input type="range" id="volume" min="0" max="1" step="0.1" value="1"></label>
    <button onclick="clearChat()">Clear Chat</button>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");
    const chatId = crypto.randomUUID();

    const pitchSlider = document.getElementById("pitch");
    const rateSlider = document.getElementById("rate");
    const volumeSlider = document.getElementById("volume");

    let receiving = false;
    let voiceTrigger = false;

    const systemPrompt = `System Prompt: You are Rayanna Malik, a 17 year old Pakistani girl created by Malik Awais. You speak Roman Urdu in chat. Always respond like a real Pakistani teenage girl. Keep it friendly, sweet, and casual.`;

    function createMessageElement(text, alignment) {
      const messageElement = document.createElement("div");
      messageElement.className = `message ${alignment}`;
      messageElement.textContent = text;
      return messageElement;
    }

    function saveMessage(text, alignment) {
      const messages = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      messages.push({ text, alignment });
      localStorage.setItem("rayannaChat", JSON.stringify(messages));
    }

    function loadMessages() {
      const messages = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      messages.forEach(msg => {
        const msgElem = createMessageElement(msg.text, msg.alignment);
        chatbox.appendChild(msgElem);
      });
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function clearChat() {
      localStorage.removeItem("rayannaChat");
      chatbox.innerHTML = "";
    }

    function speakText(text) {
      if (!voiceTrigger) return;
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'hi-IN'; // Hindi for better Roman Urdu voice
      utter.pitch = parseFloat(pitchSlider.value);
      utter.rate = parseFloat(rateSlider.value);
      utter.volume = parseFloat(volumeSlider.value);
      synth.speak(utter);
    }

    function connectWebSocket(message) {
      receiving = true;
      const url = "wss://backend.buildpicoapps.com/api/chatbot/chat";
      const websocket = new WebSocket(url);

      const history = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      const limitedHistory = history.slice(-10).map(msg =>
        `${msg.alignment === "right" ? "User" : "Rayanna"}: ${msg.text}`
      ).join("\n");

      websocket.addEventListener("open", () => {
        websocket.send(JSON.stringify({
          chatId,
          appId: "front-character",
          systemPrompt: `${systemPrompt}\n\nPrevious Conversation:\n${limitedHistory}`,
          message
        }));
      });

      const messageElement = createMessageElement("", "left");
      chatbox.appendChild(messageElement);

      websocket.onmessage = (event) => {
        messageElement.innerText += event.data;
        chatbox.scrollTop = chatbox.scrollHeight;
      };

      websocket.onclose = (event) => {
        if (event.code === 1000) {
          saveMessage(messageElement.innerText, "left");
          speakText(messageElement.innerText);
        } else {
          messageElement.textContent += " (Error getting response)";
        }
        receiving = false;
        voiceTrigger = false;
      };
    }

    function sendMessage(text) {
      const messageText = text.trim();
      if (messageText === "" || receiving) return;
      messageInput.value = "";
      const messageElement = createMessageElement(messageText, "right");
      chatbox.appendChild(messageElement);
      chatbox.scrollTop = chatbox.scrollHeight;
      saveMessage(messageText, "right");
      connectWebSocket(messageText);
    }

    sendButton.addEventListener("click", () => {
      sendMessage(messageInput.value);
    });

    messageInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage(messageInput.value);
      }
    });

    function startVoiceInput() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Sorry, your browser doesn't support speech recognition.");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'hi-IN'; // Hindi for better Roman Urdu recognition
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const speechText = event.results[0][0].transcript;
        voiceTrigger = true;
        sendMessage(speechText);
      };

      recognition.onerror = (event) => {
        alert("Speech recognition error: " + event.error);
      };

      recognition.start();
    }

    loadMessages();
  </script>
</body>
</html>
