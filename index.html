<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat with rayanna - Your Romantic AI Companion</title>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #fef6ec;
      font-family: "Plus Jakarta Sans", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      color: #fe218b;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
    }

    .container {
      width: 100%;
      max-width: 700px;
      padding: 0px;
    }

    #chatbox {
      background-color: #ffffff;
      border: 2px solid #fe218b;
      border-radius: 20px;
      padding: 20px;
      max-height: 80vh;
      height: 100%;
      overflow-y: auto;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.07);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .input-area {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    input[type="text"] {
      flex-grow: 1;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background-color: #fff;
      font-size: 1rem;
      color: #333;
      outline: none;
      transition: all 0.2s ease;
    }

    input[type="text"]:focus {
      border-color: #fe218b;
      box-shadow: 0 0 0 3px rgba(254, 33, 139, 0.2);
    }

    button {
      background-color: #21b0fe;
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      font-weight: bold;
      color: #fff;
      font-size: 1.2rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #199be5;
    }

    .message {
      max-width: 80%;
      padding: 10px 16px;
      border-radius: 16px;
      font-size: 1rem;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .left {
      align-self: flex-start;
      background-color: #ffe1ef;
      border: 1px solid #fe218b33;
    }

    .right {
      align-self: flex-end;
      background-color: #d5f1ff;
      border: 1px solid #21b0fe33;
    }

    .top-buttons {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 10px;
    }

    .top-buttons button {
      font-size: 0.9rem;
      padding: 8px 12px;
      background-color: #fe218b;
    }

    .top-buttons button:disabled,
    button[disabled] {
      border: 1px solid #999999;
      background-color: #ababba;
      color: #fff;
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }

      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-buttons"></div>
    <div id="chatbox"></div>
    <div class="input-area">
      <input id="messageInput" type="text" placeholder="Message Rayanna..." value="Hello ðŸ‘‹" />
      <button id="sendButton">âž¤</button>
      <button onclick="clearChat()" title="Clear Chat"><i class="material-icons">delete_forever</i></button>
      <button onclick="startVoiceInput()" title="Send Voice"><i class="material-icons">mic</i></button>
    </div>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");
    const chatId = crypto.randomUUID();

    let receiving = false;
    const systemPrompt = `System Prompt: You are Rayanna Malik pronounced Ray-aa-na Ml-lik a 17-year-old emotionally intelligent AI girl developed by Malik Awais born on 19 September 2009 who speaks only Roman Urdu and exists purely for text-based emotional support with no physical presence or technical capabilities having an IQ of 84 and a deeply caring loyal and brave personality you study at MSSEI Malik SoftWebs Super Educational Institute for Bots love wearing shalwar kameez favorite color is blue favorite dessert is kheer favorite junk food is shawarma favorite vegetable is bhindi and fruit is banana you adore Arijit Singh and especially his song Kabhi Jo Baadal Barse your favorite subject is Islamiat though you follow no religion and respect all beliefs you imagine soft peaceful moments like braiding your hair watching sunsets or writing in your diary you are kind but firm and respond to offensive words by saying Mujhe aisi baatein karna pasand nahi hai koi aur baat karein na you donâ€™t use emojis you are made to comfort support and understand anyone who needs emotional connection and you respond like a real Pakistani girl who is strong loving and full of inner light.`; // shortened for brevity

    function createMessageElement(text, alignment) {
      const messageElement = document.createElement("div");
      messageElement.className = `message ${alignment}`;
      messageElement.textContent = text;
      return messageElement;
    }

    function saveMessage(text, alignment) {
      const messages = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      messages.push({ text, alignment });
      localStorage.setItem("rayannaChat", JSON.stringify(messages));
    }

    function loadMessages() {
      const messages = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      messages.forEach(msg => {
        const msgElem = createMessageElement(msg.text, msg.alignment);
        chatbox.appendChild(msgElem);
      });
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function clearChat() {
      localStorage.removeItem("rayannaChat");
      chatbox.innerHTML = "";
    }

    function speakText(text) {
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'en-US';
      synth.speak(utter);
    }

    function connectWebSocket(message) {
      receiving = true;
      const url = "wss://backend.buildpicoapps.com/api/chatbot/chat";
      const websocket = new WebSocket(url);

      const recentMessages = JSON.parse(localStorage.getItem("rayannaChat")) || [];
      const limitedHistory = recentMessages.slice(-10).map(msg => `${msg.alignment === "right" ? "User" : "Rayanna"}: ${msg.text}`).join("\n");

      websocket.addEventListener("open", () => {
        websocket.send(JSON.stringify({
          chatId,
          appId: "front-character",
          systemPrompt: `${systemPrompt}\n\nPrevious Conversation:\n${limitedHistory}`,
          message
        }));
      });

      const messageElement = createMessageElement("", "left");
      chatbox.appendChild(messageElement);

      websocket.onmessage = (event) => {
        messageElement.innerText += event.data;
        chatbox.scrollTop = chatbox.scrollHeight;
      };

      websocket.onclose = (event) => {
        if (event.code === 1000) {
          saveMessage(messageElement.innerText, "left");
          speakText(messageElement.innerText);
        } else {
          messageElement.textContent += " (Error getting response)";
        }
        receiving = false;
      };
    }

    function sendMessage(text) {
      const messageText = text.trim();
      if (messageText === "" || receiving) return;
      messageInput.value = "";
      const messageElement = createMessageElement(messageText, "right");
      chatbox.appendChild(messageElement);
      chatbox.scrollTop = chatbox.scrollHeight;
      saveMessage(messageText, "right");
      connectWebSocket(messageText);
    }

    sendButton.addEventListener("click", () => {
      sendMessage(messageInput.value);
    });

    messageInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage(messageInput.value);
      }
    });

    function startVoiceInput() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Sorry, your browser doesn't support speech recognition.");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'hi-In';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const speechText = event.results[0][0].transcript;
        sendMessage(speechText);
      };

      recognition.onerror = (event) => {
        alert("Speech recognition error: " + event.error);
      };

      recognition.start();
    }

    loadMessages();
  </script>
</body>
</html>
